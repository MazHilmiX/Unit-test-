<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Leger Nilai MKABA Margodadi</title>
    <style>
        /* Style yang sama dengan sebelumnya */
        body {
            font-family: sans-serif;
            margin: 20px;
            background-color: #f4f4f4;
        }

        .container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 20px;
            background: #fff;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }

        h1 {
            text-align: center;
            margin-bottom: 20px;
            color: #333;
        }

        .input-form {
            margin-bottom: 20px;
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }

        .input-form input,
        .input-form select,
        .input-form button {
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }

        .input-form button {
            background-color: #4CAF50;
            color: white;
            border: none;
            cursor: pointer;
        }

        .input-form button:hover {
            background-color: #45a049;
        }

        .search-bar {
            margin-bottom: 20px;
            text-align: right;
        }

        .search-bar input {
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            overflow-x: auto;
        }

        table, th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: center;
        }

        th {
            background-color: #f2f2f2;
            color: #333;
            cursor: pointer;
        }

        tbody tr:nth-child(even) {
            background-color: #f9f9f9;
        }

        .delete-btn {
            background-color: #f44336;
            color: white;
            border: none;
            padding: 6px 10px;
            border-radius: 4px;
            cursor: pointer;
            margin-left: 5px;
        }

        .delete-btn:hover {
            background-color: #d32f2f;
        }

        /* Tambahan untuk responsivitas */
        .table-container {
            overflow-x: auto;
        }
        
     .header {
    display: flex;
    flex-direction: column;
    align-items: center;
    margin-bottom: 30px;
    padding: 20px 0;
}

.logo {
    height: 80px;
    width: auto;
    margin-bottom: 20px;
}

h2 {
    margin: 0;
    text-align: center;
    font-size: 12px;
    color: #2c3e50;
    font-weight: 600;
    letter-spacing: 0.5px;
    line-height: 1.4;
    padding: 0 20px;
    border-bottom: 3px solid #4CAF50;
    padding-bottom: 10px;
    text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
}

/* Tambahkan media query untuk responsivitas */
@media screen and (max-width: 768px) {
    h1 {
        font-size: 1.6em;
        padding: 0 10px;
    }
    
    .logo {
        height: 60px;
    }
}

/* Optional: Tambahkan animasi sederhana */
.header {
    animation: fadeIn 0.8s ease-in;
}

@keyframes fadeIn {
    from {
        opacity: 0;
        transform: translateY(-20px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}
    </style>
</head>

<body>
   <div class="container">
    <div class="header">
        <img src="https://mazhilmix.github.io/Website-Hifdzhuka/Lot.png" alt="Logo" class="logo">
        <h2>Daftar Nilai Ujian Tengah Semester Genap Tahun Akademik 1445 H - 1446 H</h2>
    </div>
        <div class="input-form">
            <input type="text" id="namaInput" placeholder="Nama Siswa">
            <select id="kelasInput">
                <option value="">Pilih Kelas</option>
                <option value="Kelas I">Kelas I</option>
                <option value="Kelas II I">Kelas II</option>
                <option value="Kelas IA">Kelas IA</option>
                <option value="Kelas IB">Kelas IB</option>
                <option value="Kelas II A">Kelas II</option>
            </select>
            <input type="number" id="tahfidzInput" placeholder="Tahfidzhul Qur'an" min="0" max="100">
            <input type="number" id="aqidahInput" placeholder="Aqidah Islamiyyah" min="0" max="100">
            <input type="number" id="fiqhInput" placeholder="Fiqhul Islam" min="0" max="100">
            <input type="number" id="haditsInput" placeholder="Hadits" min="0" max="100">
            <input type="number" id="bahasaArabInput" placeholder="Bahasa Arab" min="0" max="100">
            <input type="number" id="bahasaInggrisInput" placeholder="Bahasa Inggris" min="0" max="100">
            <input type="number" id="khotInput" placeholder="Khot/Mahfudzhat" min="0" max="100">
            <input type="number" id="sirohInput" placeholder="Siroh Khulafa'" min="0" max="100">
            <input type="number" id="hisabInput" placeholder="Ilmu Hisab" min="0" max="100">
            <input type="number" id="shorofInput" placeholder="Ilmu Shorof" min="0" max="100">
            <input type="number" id="nahwuInput" placeholder="Ilmu Nahwu" min="0" max="100">
            <button onclick="tambahSiswa()">Tambah Siswa</button>
        </div>
        <div style="display: flex; align-items: center; margin-bottom: 20px;">
    <input 
        type="text" 
        id="searchInput" 
        placeholder="Cari Nama Siswa" 
        style="padding: 8px; font-size: 14px; border: 1px solid #ccc; border-radius: 4px; flex: 1;"
    >
    <select 
        id="filterKelas" 
        style="margin-left: 10px; padding: 8px; font-size: 14px; border: 1px solid #ccc; border-radius: 4px;"
    >
         <option value="">Pilih Kelas</option>
                <option value="Kelas I">Kelas I</option>
                <option value="Kelas II I">Kelas II I</option>
                <option value="Kelas IA">Kelas IA</option>
                <option value="Kelas IB">Kelas IB</option>
                <option value="Kelas II A">Kelas II A</option>
            </select>
</div>
        <div class="table-container">
            <table id="nilaiTable">
                <thead>
                    <tr>
                        <th>No.</th>
                        <th onclick="sortTable(1)">Nama Siswa</th>
                        <th>Kelas</th>
                        <th onclick="sortTable(2)">Tahfidzhul Qur'an</th>
                        <th onclick="sortTable(3)">Aqidah Islamiyyah</th>
                        <th onclick="sortTable(4)">Fiqhul Islam</th>
                        <th onclick="sortTable(5)">Hadits</th>
                        <th onclick="sortTable(6)">Bahasa Arab</th>
                        <th onclick="sortTable(7)">Bahasa Inggris</th>
                        <th onclick="sortTable(8)">Khot/Mahfudzhat</th>
                        <th onclick="sortTable(9)">Siroh Khulafa'</th>
                        <th onclick="sortTable(10)">Ilmu Hisab</th>
                        <th onclick="sortTable(11)">Ilmu Shorof</th>
                        <th onclick="sortTable(12)">Ilmu Nahwu</th>
                        <th onclick="sortTable(13)">Rata-rata</th>
                        <th onclick="sortTable(14)">Ranking</th>
                        <th>Aksi</th>
                    </tr>
                </thead>
                <tbody id="nilaiBody">
                    <!-- Data nilai akan diisi oleh JavaScript -->
                </tbody>
            </table>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/9.22.1/firebase-app.js';
        import { getDatabase, ref, push, set, onValue, remove } from 'https://www.gstatic.com/firebasejs/9.22.1/firebase-database.js';

        const firebaseConfig = {
            apiKey: "AIzaSyC8X479t_V2Q_B5z79k_879p-zW54p9557",
            authDomain: "for-ppui.firebaseapp.com",
            databaseURL: "https://for-ppui-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "for-ppui",
            storageBucket: "for-ppui.firebasestorage.app",
            messagingSenderId: "395514233788",
            appId: "1:395514233788:web:f08cb24b1ca369fa7e21b9",
            measurementId: "G-KN8PCBGYBY"
        };

        const app = initializeApp(firebaseConfig);
        const database = getDatabase(app);
        const nilaiRef = ref(database, 'nilaiSiswa');

        document.addEventListener('DOMContentLoaded', function () {
            const nilaiBody = document.getElementById('nilaiBody');
            const searchInput = document.getElementById('searchInput');

            // Fungsi untuk menghitung rata-rata
            function hitungRataRata(siswa) {
                const totalNilai = 
                    siswa.tahfidz + 
                    siswa.aqidah + 
                    siswa.fiqh + 
                    siswa.hadits + 
                    siswa.bahasaArab + 
                    siswa.bahasaInggris + 
                    siswa.khot + 
                    siswa.siroh + 
                    siswa.hisab + 
                    siswa.shorof + 
                    siswa.nahwu;
                return parseFloat((totalNilai / 11).toFixed(2));
            }

            // Fungsi untuk menentukan ranking
            function tentukanRanking(data) {
                const siswaDenganRataRata = data.map(siswa => ({
                    ...siswa,
                    rataRata: hitungRataRata(siswa)
                }));

                siswaDenganRataRata.sort((a, b) => b.rataRata - a.rataRata);

                return siswaDenganRataRata.map((siswa, index) => ({
                    ...siswa,
                    ranking: index + 1
                }));
            }

            // Fungsi untuk menampilkan data ke tabel
            function tentukanRanking(data) {
    // Kelompokkan siswa berdasarkan kelas
    const siswaPerKelas = {};
    
    data.forEach(siswa => {
        if (!siswaPerKelas[siswa.kelas]) {
            siswaPerKelas[siswa.kelas] = [];
        }
        siswaPerKelas[siswa.kelas].push({
            ...siswa,
            rataRata: hitungRataRata(siswa)
        });
    });

    // Tentukan ranking untuk setiap kelas
    const hasilRanking = [];
    Object.keys(siswaPerKelas).forEach(kelas => {
        const siswaDalamKelas = siswaPerKelas[kelas];
        // Sort siswa dalam kelas berdasarkan rata-rata
        siswaDalamKelas.sort((a, b) => b.rataRata - a.rataRata);
        
        // Tambahkan ranking ke setiap siswa dalam kelas
        siswaDalamKelas.forEach((siswa, index) => {
            hasilRanking.push({
                ...siswa,
                ranking: index + 1
            });
        });
    });

    return hasilRanking;
}
            function tampilkanData(data, dataKeys = []) {
    nilaiBody.innerHTML = '';
    let siswaRanking = tentukanRanking(data);

    // Filter berdasarkan kelas yang dipilih
    const kelasFilter = filterKelas.value;
    if (kelasFilter) {
        siswaRanking = siswaRanking.filter(siswa => siswa.kelas === kelasFilter);
    }

    siswaRanking.forEach((siswa, index) => {
        const row = nilaiBody.insertRow();
        row.insertCell().textContent = index + 1;
        row.insertCell().textContent = siswa.nama;
        row.insertCell().textContent = siswa.kelas;
        row.insertCell().textContent = siswa.tahfidz;
        row.insertCell().textContent = siswa.aqidah;
        row.insertCell().textContent = siswa.fiqh;
        row.insertCell().textContent = siswa.hadits;
        row.insertCell().textContent = siswa.bahasaArab;
        row.insertCell().textContent = siswa.bahasaInggris;
        row.insertCell().textContent = siswa.khot;
        row.insertCell().textContent = siswa.siroh;
        row.insertCell().textContent = siswa.hisab;
        row.insertCell().textContent = siswa.shorof;
        row.insertCell().textContent = siswa.nahwu;
        row.insertCell().textContent = siswa.rataRata;
        row.insertCell().textContent = siswa.ranking;

        const deleteButton = document.createElement('button');
        deleteButton.textContent = 'Hapus';
        deleteButton.classList.add('delete-btn');
        deleteButton.onclick = () => hapusSiswa(dataKeys[index] || Object.keys(data)[index]);
        row.insertCell().appendChild(deleteButton);
    });
}

// Membaca data dari Firebase
onValue(nilaiRef, (snapshot) => {
    const data = snapshot.val();
    if (data) {
        const dataArray = Object.values(data);
        const dataKeys = Object.keys(data);
        tampilkanData(dataArray, dataKeys);
    } else {
        tampilkanData([]);
    }
}, (error) => {
    console.error("Error membaca data:", error);
});

// Pencarian data
searchInput.addEventListener('input', function () {
    const searchTerm = searchInput.value.toLowerCase();
    onValue(nilaiRef, (snapshot) => {
        const data = snapshot.val();
        if (data) {
            const dataArray = Object.values(data);
            const dataKeys = Object.keys(data);
            const filteredData = dataArray.filter(siswa =>
                siswa.nama.toLowerCase().includes(searchTerm)
            );
            const filteredKeys = dataKeys.filter((key, index) => 
                dataArray[index].nama.toLowerCase().includes(searchTerm)
            );
            tampilkanData(filteredData, filteredKeys);
        } else {
            tampilkanData([]);
        }
    });
});

// Menghapus data siswa
window.hapusSiswa = function (siswaId) {
    if (confirm("Anda yakin ingin menghapus data siswa ini?")) {
        const siswaRef = ref(database, `nilaiSiswa/${siswaId}`);
        remove(siswaRef)
            .then(() => {
                console.log('Data siswa berhasil dihapus dari Firebase');
            })
            .catch((error) => {
                console.error('Gagal menghapus data siswa dari Firebase:', error);
                alert('Gagal menghapus data siswa');
            });
    }
};

// Filter berdasarkan kelas yang dipilih
filterKelas.addEventListener('change', function() {
    onValue(nilaiRef, (snapshot) => {
        const data = snapshot.val();
        if (data) {
            const dataArray = Object.values(data);
            const dataKeys = Object.keys(data);
            const searchTerm = searchInput.value.toLowerCase();
            
            let filteredData = dataArray;
            // Filter berdasarkan pencarian nama
            if (searchTerm) {
                filteredData = filteredData.filter(siswa =>
                    siswa.nama.toLowerCase().includes(searchTerm)
                );
            }
            
            tampilkanData(filteredData, dataKeys);
        } else {
            tampilkanData([]);
        }
    });
});

            // Menambahkan siswa ke Firebase
            window.tambahSiswa = function () {
                const nama = document.getElementById('namaInput').value.trim();
                const kelas = document.getElementById('kelasInput').value;
                const tahfidz = parseInt(document.getElementById('tahfidzInput').value);
                const aqidah = parseInt(document.getElementById('aqidahInput').value);
                const fiqh = parseInt(document.getElementById('fiqhInput').value);
                const hadits = parseInt(document.getElementById('haditsInput').value);
                const bahasaArab = parseInt(document.getElementById('bahasaArabInput').value);
                const bahasaInggris = parseInt(document.getElementById('bahasaInggrisInput').value);
                const khot = parseInt(document.getElementById('khotInput').value);
                const siroh = parseInt(document.getElementById('sirohInput').value);
                const hisab = parseInt(document.getElementById('hisabInput').value);
                const shorof = parseInt(document.getElementById('shorofInput').value);
                const nahwu = parseInt(document.getElementById('nahwuInput').value);

                // Validasi input
                if (!nama) {
                    alert("Nama siswa tidak boleh kosong!");
                    return;
                }

                if (!kelas) {
                    alert("Pilih kelas terlebih dahulu!");
                    return;
                }

                // Validasi nilai
                const nilaiInput = [
                    { label: 'Tahfidzhul Qur\'an', value: tahfidz },
                    { label: 'Aqidah Islamiyyah', value: aqidah },
                    { label: 'Fiqhul Islam', value: fiqh },
                    { label: 'Hadits', value: hadits },
                    { label: 'Bahasa Arab', value: bahasaArab },
                    { label: 'Bahasa Inggris', value: bahasaInggris },
                    { label: 'Khot/Mahfudzhat', value: khot },
                    { label: 'Siroh Khulafa\'', value: siroh },
                    { label: 'Ilmu Hisab', value: hisab },
                    { label: 'Ilmu Shorof', value: shorof },
                    { label: 'Ilmu Nahwu', value: nahwu }
                ];

                const invalidNilai = nilaiInput.find(input => 
                    isNaN(input.value) || input.value < 0 || input.value > 100
                );

                if (invalidNilai) {
                    alert(`Nilai ${invalidNilai.label} harus antara 0-100!`);
                    return;
                }

                const newSiswaRef = push(nilaiRef);
                set(newSiswaRef, {
                    nama: nama,
                    kelas: kelas,
                    tahfidz: tahfidz,
                    aqidah: aqidah,
                    fiqh: fiqh,
                    hadits: hadits,
                    bahasaArab: bahasaArab,
                    bahasaInggris: bahasaInggris,
                    khot: khot,
                    siroh: siroh,
                    hisab: hisab,
                    shorof: shorof,
                    nahwu: nahwu
                })
                .then(() => {
                    // Reset form setelah berhasil
                    document.getElementById('namaInput').value = '';
                    document.getElementById('kelasInput').value = '';
                    document.getElementById('tahfidzInput').value = '';
                    document.getElementById('aqidahInput').value = '';
                    document.getElementById('fiqhInput').value = '';
                    document.getElementById('haditsInput').value = '';
                    document.getElementById('bahasaArabInput').value = '';
                    document.getElementById('bahasaInggrisInput').value = '';
                    document.getElementById('khotInput').value = '';
                    document.getElementById('sirohInput').value = '';
                    document.getElementById('hisabInput').value = '';
                    document.getElementById('shorofInput').value = '';
                    document.getElementById('nahwuInput').value = '';
                    console.log('Data siswa berhasil ditambahkan');
                })
                .catch((error) => {
                    console.error('Gagal menambahkan data siswa:', error);
                    alert('Gagal menambahkan data siswa');
                });
            }

            // Fungsi sorting data
            window.sortTable = function (columnIndex) {
                onValue(nilaiRef, (snapshot) => {
                    const data = snapshot.val();
                    if (data) {
                        const dataArray = Object.values(data);
                        const siswaDenganRataRata = dataArray.map(siswa => ({
                            ...siswa,
                            rataRata: hitungRataRata(siswa)
                        }));

                        switch (columnIndex) {
                            case 1: // Nama
                                siswaDenganRataRata.sort((a, b) => a.nama.localeCompare(b.nama));
                                break;
                            case 2: // Tahfidz
                                siswaDenganRataRata.sort((a, b) => b.tahfidz - a.tahfidz);
                                break;
                            case 3: // Aqidah
                                siswaDenganRataRata.sort((a, b) => b.aqidah - a.aqidah);
                                break;
                            case 4: // Fiqh
                                siswaDenganRataRata.sort((a, b) => b.fiqh - a.fiqh);
                                break;
                            case 5: // Hadits
                                siswaDenganRataRata.sort((a, b) => b.hadits - a.hadits);
                                break;
                            case 6: // Bahasa Arab
                                siswaDenganRataRata.sort((a, b) => b.bahasaArab - a.bahasaArab);
                                break;
                            case 7: // Bahasa Inggris
                                siswaDenganRataRata.sort((a, b) => b.bahasaInggris - a.bahasaInggris);
                                break;
                            case 8: // Khot
                                siswaDenganRataRata.sort((a, b) => b.khot - a.khot);
                                break;
                            case 9: // Siroh
                                siswaDenganRataRata.sort((a, b) => b.siroh - a.siroh);
                                break;
                            case 10: // Hisab
                                siswaDenganRataRata.sort((a, b) => b.hisab - a.hisab);
                                break;
                            case 11: // Shorof
                                siswaDenganRataRata.sort((a, b) => b.shorof - a.shorof);
                                break;
                            case 12: // Nahwu
                                siswaDenganRataRata.sort((a, b) => b.nahwu - a.nahwu);
                                break;
                            case 13: // Rata-rata
                                siswaDenganRataRata.sort((a, b) => b.rataRata - a.rataRata);
                                break;
                            case 14: // Ranking
                                const rankedSiswa = tentukanRanking(dataArray);
                                rankedSiswa.sort((a, b) => a.ranking - b.ranking);
                                tampilkanData(rankedSiswa);
                                return;
                        }
                        tampilkanData(siswaDenganRataRata);
                    } else {
                        tampilkanData([]);
                    }
                }, (error) => {
                    console.error("Error sorting data:", error);
                });
            };
        });
   
    </script>
</body>
</html>
